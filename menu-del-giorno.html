<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu del Giorno</title>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">

<style>

body {
    background-color: #1a1a1a;
    margin: 0;
    padding: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    animation: fadeIn 0.8s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.contenitore {
    width: 100%;
    max-width: 420px;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 5px;
}

/* LAVAGNA */
.lavagna {
    background: #000 url('https://raw.githubusercontent.com/encharm/Font-Awesome-SVG-PNG/master/blackboard.png') repeat;
    background-size: 400px;
    filter: contrast(1.05) brightness(0.95);
    border: 6px double #FFD700;
    padding: 25px 15px;
    width: 100%;
    box-shadow: 0 0 40px rgba(255,215,0,0.25);
    text-align: center;
    border-radius: 4px;
    position: relative;
    box-sizing: border-box;
}

/* DATA + TESTO SU UNA RIGA */
.intestazione {
    color: #FFD700;
    font-size: 1.25rem;
    margin-bottom: 15px;
    font-style: italic;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    white-space: nowrap;
}

.data-serviamo {
    color: rgba(255, 215, 0, 0.85);
    font-size: 1rem;
    font-style: normal;
}

/* TITOLI */
h2 {
    color: #FFD700;
    margin-top: 15px;
    margin-bottom: 8px;
    font-size: 1.2rem;
    text-transform: uppercase;
    border-bottom: 1px dashed rgba(255, 215, 0, 0.4);
    display: inline-block;
    padding: 0 10px 3px 10px;
    text-shadow: 0 0 4px rgba(255,215,0,0.25);
    letter-spacing: 1px;
}

ul {
    list-style-type: none;
    padding: 0;
    margin: 0;
}

li {
    color: #FFFFFF;
    font-size: 1.15rem;
    margin: 6px 0;
    line-height: 1.25;
    word-break: break-word;
}

/* PIATTI TOP SU DUE RIGHE */
.piatto-nome {
    display: block;
}

.piatto-meta {
    display: block;
    font-size: 0.9rem;
    opacity: 0.85;
}

/* Il piatto top NON diventa oro: resta bianco */
li.top-dish {
    color: #FFFFFF !important;
    font-weight: bold;
    text-shadow: none;
}

/* Nome del piatto: bianco elegante */
.top-dish .piatto-nome {
    color: #FFFFFF !important;
    font-weight: 600;
}

/* Stelle + Regione: oro elegante */
.top-dish .piatto-meta {
    color: #c9a23f !important; /* oro elegante */
    font-weight: 500;
    font-size: 0.9rem;
}

}

li.top-dish:hover {
    text-shadow: 0 0 10px rgba(255,215,0,0.9);
    transform: scale(1.02);
}

/* CHIUSURA */
.chiusura {
    margin-top: 25px;
    color: #FFD700;
    font-size: 1rem;
    opacity: 0.7;
}

/* WHATSAPP */
#whatsapp-vertical {
    position: fixed !important;
    right: -6px !important;
    top: 40% !important;
    background: #FFD700 !important;
    padding: 8px 6px !important;
    border-radius: 6px 0 0 6px !important;
    cursor: pointer !important;
    z-index: 9999 !important;
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    gap: 4px !important;
}

.whatsapp-icon {
    width: 22px !important;
    height: 22px !important;
    filter: hue-rotate(90deg) saturate(2);
}

.whatsapp-text {
    writing-mode: vertical-rl !important;
    text-orientation: upright !important;
    color: #0a7c2f !important;
    font-weight: bold !important;
    font-size: 12px !important;
    letter-spacing: 0.5px !important;
}

/* LEGENDA */
.legenda-badges {
    margin-top: 20px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.2);
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
    color: white;
    font-size: 0.95rem;
}

.legenda-badges span {
    background: rgba(255,255,255,0.08);
    padding: 6px 10px;
    border-radius: 6px;
    display: inline-block;
}
/* Riduce SOLO l'emoji accanto al nome, NON il testo */
.top-dish .piatto-nome .emoji {
    font-size: 0.8rem !important;
    vertical-align: middle;
    margin-right: 4px;
}

</style>
</head>

<body>

<!-- WHATSAPP -->
<div id="whatsapp-vertical" onclick="condividiWhatsApp()">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="whatsapp-icon">
    <span class="whatsapp-text">Invia Menu</span>
</div>

<div class="contenitore">

    <div class="lavagna">

        <!-- DATA + TESTO -->
        <div class="intestazione">
            <span id="data-odierna" class="data-serviamo"></span>
            <span>Oggi vi serviamo...</span>
        </div>

        <section>
            <h2>‚ú¶ Primi</h2>
            <ul>
                <li>Spaghetti alla Carbonara</li>
                <li>Risotto ai Funghi Porcini</li>
                <li>Spaghetti al Pomodoro e Basilico</li>
            </ul>
        </section>

        <section>
            <h2>‚ú¶ Secondi</h2>
            <ul>
                <li>Cotoletta alla Milanese</li>
                <li>Pollo Arrosto con Patate</li>
                <li>Branzino al Forno</li>
            </ul>
        </section>

        <section>
            <h2>‚ú¶ Contorni</h2>
            <ul>
                <li>Zucchine Trifolate</li>
                <li>Finocchi al Burro</li>
                <li>Mix di Verdure Lessate</li>
            </ul>
        </section>

        <div class="chiusura">‚ú¶ Grazie e Buon Appetito ‚ú¶</div>

        <div class="legenda-badges">
            <span>ü•á Iconico</span>
            <span>üî• Top</span>
            <span>‚≠ê Storico</span>
            <span>‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ Punteggio</span>
            <span>Regione di origine</span>
        </div>

    </div>
</div>

<!-- DATA -->
<script>
const opzioni = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };

let data = new Date().toLocaleDateString('it-IT', opzioni);
data = data.charAt(0).toUpperCase() + data.slice(1);

document.getElementById('data-odierna').textContent = data;
</script>

<!-- SCRIPT AVANZATO RIFATTO -->
<script>
/* ============================
   BASE DATI TOP PIATTI ITALIANI
   (SCALABILE A 3000+ VOCI)
============================ */

// Esempio struttura: qui vanno poi inseriti TUTTI i piatti (3000+)
// Puoi tenerli in un file separato e importarli, ma per ora li lasciamo inline come struttura.
const TOP_PIATTI = {
  "spaghetti alla carbonara": {
    categoria: "primo",
    regione: "Lazio",
    iconico: true,
    top: true,
    storico: true,
    punteggio: 5,
    sinonimi: ["carbonara", "spaghetti carbonara"],
    allergeni: ["glutine", "uova", "latte"],
    dieta: "carne"
  },
  "risotto ai funghi porcini": {
    categoria: "primo",
    regione: "Lombardia",
    iconico: false,
    top: true,
    storico: true,
    punteggio: 4,
    sinonimi: ["risotto ai funghi"],
    allergeni: ["glutine", "latte"],
    dieta: "vegetariano"
  },
  "spaghetti al pomodoro e basilico": {
    categoria: "primo",
    regione: "Italia",
    iconico: true,
    top: true,
    storico: true,
    punteggio: 4,
    sinonimi: ["spaghetti al pomodoro", "spaghetti pomodoro e basilico"],
    allergeni: ["glutine"],
    dieta: "vegetariano"
  },
  "cotoletta alla milanese": {
    categoria: "secondo",
    regione: "Lombardia",
    iconico: true,
    top: true,
    storico: true,
    punteggio: 5,
    sinonimi: ["cotoletta", "cotoletta di vitello"],
    allergeni: ["glutine", "uova"],
    dieta: "carne"
  },
  "pollo arrosto con patate": {
    categoria: "secondo",
    regione: "Italia",
    iconico: false,
    top: true,
    storico: false,
    punteggio: 3,
    sinonimi: ["pollo arrosto", "pollo al forno con patate"],
    allergeni: [],
    dieta: "carne"
  },
  "branzino al forno": {
    categoria: "secondo",
    regione: "Liguria",
    iconico: false,
    top: true,
    storico: true,
    punteggio: 4,
    sinonimi: ["spigola al forno"],
    allergeni: ["pesce"],
    dieta: "pesce"
  },
  "zucchine trifolate": {
    categoria: "contorno",
    regione: "Italia",
    iconico: false,
    top: true,
    storico: true,
    punteggio: 3,
    sinonimi: ["zucchine in padella"],
    allergeni: [],
    dieta: "vegetariano"
  },
  "finocchi al burro": {
    categoria: "contorno",
    regione: "Italia",
    iconico: false,
    top: false,
    storico: false,
    punteggio: 2,
    sinonimi: [],
    allergeni: ["latte"],
    dieta: "vegetariano"
  },
  "mix di verdure lessate": {
    categoria: "contorno",
    regione: "Italia",
    iconico: false,
    top: false,
    storico: false,
    punteggio: 2,
    sinonimi: ["verdure bollite"],
    allergeni: [],
    dieta: "vegetariano"
  }
  // QUI SI AGGIUNGONO TUTTI GLI ALTRI PIATTI (FINO A 3000+)
};

/* ============================
   NORMALIZZAZIONE NOME PIATTO
============================ */
function normalizzaNome(nome) {
  return nome
    .toLowerCase()
    .trim()
    .replace(/\s+/g, " ");
}

/* ============================
   RICERCA PIATTO NELLA TOP
   (supporta sinonimi)
============================ */
function trovaPiatto(nomePiatto) {
  const n = normalizzaNome(nomePiatto);

  // 1) match diretto
  if (TOP_PIATTI[n]) return TOP_PIATTI[n];

  // 2) match su sinonimi
  for (const [nomeBase, dati] of Object.entries(TOP_PIATTI)) {
    if (dati.sinonimi && dati.sinonimi.some(s => normalizzaNome(s) === n)) {
      return dati;
    }
  }

  // 3) nessun match
  return null;
}

/* ============================
   ALLERGENI AUTOMATICI (fallback)
============================ */
function allergeniAutomatici(nomePiatto, datiTop) {
  // Se il piatto √® in TOP_PIATTI e ha allergeni definiti, usiamo quelli
  if (datiTop && Array.isArray(datiTop.allergeni)) {
    return datiTop.allergeni;
  }

  // Fallback semplice basato su parole chiave
  const t = normalizzaNome(nomePiatto);
  const a = [];

  if (t.includes("panna") || t.includes("burro") || t.includes("formaggio") || t.includes("zola") || t.includes("mozzarella"))
    a.push("latte");

  if (t.includes("uova") || t.includes("carbonara") || t.includes("maionese"))
    a.push("uova");

  if (t.includes("farina") || t.includes("pasta") || t.includes("penne") || t.includes("spaghetti") || t.includes("pappardelle") || t.includes("gnocchi") || t.includes("lasagne"))
    a.push("glutine");

  if (t.includes("tonno") || t.includes("acciughe") || t.includes("salmone") || t.includes("pesce") || t.includes("branzino") || t.includes("spigola"))
    a.push("pesce");

  if (t.includes("noci") || t.includes("mandorle") || t.includes("nocciole") || t.includes("pistacchi"))
    a.push("frutta a guscio");

  return [...new Set(a)];
}

/* ============================
   DIETA AUTOMATICA (fallback)
============================ */
function dietaAutomatica(nomePiatto, datiTop) {
  if (datiTop && datiTop.dieta) return datiTop.dieta;

  const t = normalizzaNome(nomePiatto);

  if (t.includes("salmone") || t.includes("tonno") || t.includes("acciughe") || t.includes("pesce") || t.includes("branzino") || t.includes("spigola"))
    return "pesce";

  if (t.includes("arrosto") || t.includes("maiale") || t.includes("tacchino") || t.includes("coppa") || t.includes("salsiccia") || t.includes("pollo") || t.includes("vitello") || t.includes("manzo"))
    return "carne";

  if (t.includes("verdure") || t.includes("zucchine") || t.includes("finocchi") || t.includes("insalata") || t.includes("patate") || t.includes("fagioli") || t.includes("lenticchie"))
    return "vegetariano";

  return "non specificato";
}

/* ============================
   REGIONALIT√Ä (usa TOP, poi fallback)
============================ */
function regionalitaPiatto(nomePiatto, datiTop) {
  if (datiTop && datiTop.regione) return datiTop.regione;

  const t = normalizzaNome(nomePiatto);

  if (t.includes("carbonara") || t.includes("amatriciana") || t.includes("cacio e pepe"))
    return "Lazio";

  if (t.includes("rag√π") || t.includes("pappardelle"))
    return "Emilia Romagna / Toscana";

  if (t.includes("milanese") || t.includes("ossobuco"))
    return "Lombardia";

  if (t.includes("norma") || t.includes("sarde") || t.includes("arancini") || t.includes("caponata"))
    return "Sicilia";

  return "Italia";
}

/* ============================
   TRADUZIONI SEMPLICI
============================ */
function traduci(nomePiatto, lingua) {
  const diz = {
    "spaghetti alla carbonara": { en: "Spaghetti Carbonara" },
    "risotto ai funghi porcini": { en: "Porcini Mushroom Risotto" },
    "spaghetti al pomodoro e basilico": { en: "Spaghetti with Tomato and Basil" },
    "cotoletta alla milanese": { en: "Milanese Cutlet" },
    "pollo arrosto con patate": { en: "Roast Chicken with Potatoes" },
    "branzino al forno": { en: "Baked Sea Bass" }
  };
  const key = normalizzaNome(nomePiatto);
  return diz[key]?.[lingua] || nomePiatto;
}

/* ============================
   QR CODE
============================ */
function generaQRCode() {
  return "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" + encodeURIComponent(window.location.href);
}

/* ============================
   STELLE
============================ */
function stelle(n) {
  const s = Math.max(0, Math.min(5, n || 0));
  return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".slice(0, s) + "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ".slice(0, 5 - s);
}

/* ============================
   EVIDENZIAZIONE PIATTI TOP (NUOVA VERSIONE)
============================ */
function evidenziaPiattiTop() {
  const piatti = document.querySelectorAll("section ul li");

  piatti.forEach(li => {
    const nomeOriginale = li.textContent.trim();
    const datiTop = trovaPiatto(nomeOriginale);

    if (datiTop) {

      // Emoji del badge
      let badgeIcon = "‚≠ê";
      if (datiTop.iconico) badgeIcon = "ü•á";
      else if (datiTop.top) badgeIcon = "üî•";

      // Categoria gastronomica (nuova)
      const categoria = categoriaPiatto(datiTop.punteggio);

      // Applica stile top
      li.classList.add("top-dish");

      // HTML aggiornato (senza stelle, senza voti)
      li.innerHTML = `
        <span class="piatto-nome"><span class="emoji">${badgeIcon}</span> ${nomeOriginale}</span>
        <span class="piatto-meta">${categoria} ‚Äî ${datiTop.regione}</span>
      `;
    }
  });
}


/* ============================
   ESTRAZIONE PIATTI DAL DOM
============================ */
function estraiPiatti(selector) {
  return Array.from(document.querySelectorAll(selector))
    .map(li => li.textContent.trim())
    .filter(t => t.length > 0);
}

/* ============================
   GENERAZIONE JSON-LD
============================ */
function generaMenuSection(nome, piatti) {
  return {
    "@type": "MenuSection",
    "name": nome,
    "hasMenuItem": piatti.map(piatto => {
      const datiTop = trovaPiatto(piatto);

      return {
        "@type": "MenuItem",
        "name": piatto,
        "description": "Piatto del giorno preparato secondo tradizione italiana.",
        "image": "",
        "allergen": allergeniAutomatici(piatto, datiTop),
        "region": regionalitaPiatto(piatto, datiTop),
        "suitableForDiet": dietaAutomatica(piatto, datiTop),
        "offers": {
          "@type": "Offer",
          "price": "14.00",
          "priceCurrency": "EUR"
        },
        "alternateName": traduci(piatto, "en"),
        "isTopDish": !!datiTop,
        "topScore": datiTop ? datiTop.punteggio : null,
        "topIconico": datiTop ? !!datiTop.iconico : null,
        "topStorico": datiTop ? !!datiTop.storico : null,
        "topBadge": datiTop
          ? (datiTop.iconico ? "Piatto Iconico" : datiTop.top ? "Piatto Top" : "Piatto Storico")
          : null,
        "topRegion": datiTop ? datiTop.regione : null
      };
    })
  };
}

function generaJSONLD() {
  const primi = estraiPiatti("section:nth-of-type(1) ul li");
  const secondi = estraiPiatti("section:nth-of-type(2) ul li");
  const contorni = estraiPiatti("section:nth-of-type(3) ul li");

  const jsonLD = {
    "@context": "https://schema.org",
    "@type": "Menu",
    "name": "Menu del Giorno - Locanda del Contadino",
    "description": "Menu del giorno con piatti tipici italiani.",
    "servesCuisine": "Italian",
    "image": generaQRCode(),
    "hasMenuSection": [
      generaMenuSection("Primi", primi),
      generaMenuSection("Secondi", secondi),
      generaMenuSection("Contorni", contorni)
    ]
  };

  const script = document.createElement("script");
  script.type = "application/ld+json";
  script.textContent = JSON.stringify(jsonLD, null, 2);
  document.body.appendChild(script);
}

/* ============================
   AVVIO
============================ */
window.onload = function() {
  evidenziaPiattiTop();
  generaJSONLD();
};
</script>

</body>
</html>
